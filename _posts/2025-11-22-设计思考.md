---
title: 读完六篇云网络架构Paper，我得到了什么？
date: 2025-11-22
categories: [云网络]
tags: [云网络]     # TAG names should always be lowercase
description: 工程师们面对的不是一条笔直的大道，而是一个又一个的“十字路口”。每一个路口都代表一个核心的设计权衡
---

最近在做云网络的paper，师兄给了一份paperlist，文章末尾有。最近刚把这些读完。
读完之后，觉得在构建支撑全球云服务的网络时，工程师们面对的不是一条笔直的大道，而是一个又一个的“十字路口”。每一个路口都代表一个核心的设计权衡,这里写一份简单的思考。


---

## 权衡一：软件的灵活性 vs. 硬件的性能

这是云网络最经典、最核心的矛盾。

*   **软件的极致灵活性：** 工程师可以在软件中天马行空，快速迭代新功能（如新的隧道协议、更复杂的负载均衡算法）。但是有CPU Tax，而且处理速度比不上硬件。可以bypass kernel缓解这个问题，但是PCIe传输是无法避免的。

*   **硬件的极致性能：** 以**DPU/智能网卡**为代表。通过将数据平面（Data Plane）的功能固化到ASIC或FPGA芯片上，可以实现接近物理极限的线速转发，并将CPU占用率降至几乎为零。但硬件的开发周期以年为单位，一旦功能被烧录进芯片，就难以修改。这与云业务“每周更新”的节奏格格不入。即使是灵活的FPGA，其开发和验证的复杂度也远超软件。

“混合模式”：**
VFP的硬件卸载（offload）方案是这个权衡的完美体现。它保留了软件的“大脑”，用于处理复杂、多变的**控制平面**和**首包（慢路径）**的策略计算。同时，它将计算结果（编译好的流表项）下发到硬件，让硬件去执行千万次重复的**数据平面（快路径）**转发。

> **结论：** 最优解不是二选一，而是“软硬结合”。让软件负责复杂性和灵活性，让硬件负责规模和性能。

> VFP: A Virtual Switch Platform for Host SDN in the Public Cloud

---

## 权衡二：工作量保持 vs. 严格隔离

这个权衡的核心在于：当资源有空闲时，应不应该让某些用户“多用一点”？

*   **工作量保持（Work-Conserving）：** 这是一种追求“效率最大化”的思路。如果整个交换机资源有50%的空闲，那么让某个需要突发流量的VM临时占用这些资源，可以极大地提高资源利用率，看起来非常高效。

*   **严格隔离（Strict Isolation）：** 这是**PicNIC**等研究强调的“**性能可预测性**”思路。它认为，云网络的首要任务是兑现服务等级协议（SLO）。一个用户的突发流量，可能会导致另一个用户的网络延迟急剧增加，形成“**吵闹的邻居**”问题。特别是对于处理大量小包的应用（高PPS），对vSwitch造成的处理压力远超其带宽（BPS）所体现的。

**PicNIC的洞察——内部拥塞控制：**
PicNIC指出，vSwitch本身就是一个需要进行“拥塞控制”的微型网络。当它检测到某个VM的处理队列开始堆积时，必须在微秒级内向上游发送“反压（Backpressure）"信号，从源头遏制住流量。这种机制必须能够快速在“允许突发”和“严格隔离”两种模式间切换，以同时保证效率和SLA。

> **结论：** 在云网络中，可预测性（Predictability）通常比原始吞吐量（Throughput）更重要。允许突发的“效率”不能以牺牲其他租户的“公平”为代价。

> PicNIC: Predictable Virtualized NIC

---

## 权衡三：主机扩展 vs. 远端扩展

这个权衡关乎数据中心最根本的组织形式。

*   **主机附属（Host-Attached）：** 当资源不够用的时候，直接DPU上送Host侧。利用Host的CPU，memory。

*   **主机附属的浪费：** **Sirius**, **Nezha**用其他host的空闲资源来做扩展，用的是远端CPU，memory。

> **结论：** 主机扩展胜在速度快，但是会影响其他VM，有Noisy Neighbor的问题。远端扩展也不是全能，会有latency的增加。 我们现在正在work on this topic.

> Nezha: SmartNIC-based Virtual Switch Load Sharing
> Disaggregating Stateful Network Functions

---

## 权衡四：所有流一视同仁 VS 二八分布

- VFP把所有的流的fast path都变成Unified Flow
- 而Andromeda把部分重要的流进fast path，绝大部分不重要的流都走offhost的部分。 这能很大的节省内存。

> Andromeda: Performance, Isolation, and Velocity at Scale in Cloud Network Virtualization
> VFP: A Virtual Switch Platform for Host SDN in the Public Cloud


0. VFP: A Virtual Switch Platform for Host SDN in the Public Cloud
1. Azure Accelerated Networking: SmartNICs in the Public Cloud
2. Andromeda: Performance, Isolation, and Velocity at Scale in Cloud Network Virtualization
3. PicNIC: Predictable Virtualized NIC
4. Revisiting the Open VSwitch Dataplane Ten Years Later
5. Disaggregating Stateful Network Functions
6. Nezha: SmartNIC-based Virtual Switch Load Sharing